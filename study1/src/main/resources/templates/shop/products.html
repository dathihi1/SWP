<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${shop.shopName} + ' - Sản phẩm'">Shop - Sản phẩm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .product-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .unique-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #28a745;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            z-index: 2;
        }

        .sponsored-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: #ffc107;
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 8px;
            font-weight: bold;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }

        .product-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .product-rating {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .product-sales {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }

        .product-seller {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }

        .product-type {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .product-description {
            font-size: 11px;
            color: #555;
            margin-bottom: 8px;
            line-height: 1.4;
        }


        .stars {
            color: #ffc107;
            font-size: 12px;
        }

        .verified-badge {
            background: #17a2b8;
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 8px;
            font-weight: bold;
        }

        .online-badge {
            background: #28a745;
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 8px;
            font-weight: bold;
        }

        .policy-text {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 12px;
            color: #2d5a2d;
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
        }

        .policy-marquee {
            display: inline-block;
            animation: scroll-left 20s linear infinite;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .search-filters {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header-balance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .back-to-shops-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .back-to-shops-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .shop-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(13, 110, 253, 0.1);
            border-radius: 25px;
            border: 1px solid rgba(13, 110, 253, 0.2);
        }
        .shop-name {
            font-weight: 600;
            color: #0d6efd;
            font-size: 16px;
        }
        .shop-badges {
            display: flex;
            gap: 5px;
        }

    </style>
    <script src="/js/auth.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container">
        <div class="header-balance">
            <!-- Left Side -->
            <div class="header-left">
                <a class="navbar-brand d-flex align-items-center me-2" th:href="@{/}" href="/">
                    <i class="fa-solid fa-cart-shopping me-2 text-primary" style="font-size: 1.5rem;"></i>
                    <span class="fw-bold">MMO Market</span>
                </a>
            </div>

            <!-- Right Side -->
            <div class="header-right">
                <div th:if="${!isAuthenticated}" class="d-flex align-items-center gap-2">
                    <a class="btn btn-outline-secondary d-flex align-items-center gap-2" th:href="@{/login}" href="/login">
                        <i class="fa-regular fa-user"></i>
                        <span>Đăng nhập</span>
                    </a>
                    <a class="btn btn-outline-danger d-flex align-items-center gap-2" th:href="@{/cart}" href="/cart" aria-label="Giỏ hàng">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <span>Giỏ hàng</span>
                    </a>
                </div>

                <div th:if="${isAuthenticated}" class="d-flex align-items-center gap-2">
                    <div class="btn btn-outline-success d-flex align-items-center gap-2" onclick="location.href='/payment'">
                        <i class="fa-solid fa-wallet"></i>
                        <span class="fw-bold" th:text="${#numbers.formatDecimal(walletBalance, 0, 'COMMA', 0, 'POINT')}">0</span>
                    </div>

                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown">
                            <img th:src="@{/api/profile/avatar/me}" 
                                 class="rounded-circle" 
                                 style="width: 24px; height: 24px; object-fit: cover;"
                                 alt="Avatar"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <i class="fa-solid fa-user" style="display: none;"></i>
                            <span th:text="${username}">User</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" th:href="@{/profile}" href="/profile"><i class="fa-solid fa-user me-2"></i>Thông tin cá nhân</a></li>
                            <li><a class="dropdown-item" th:href="@{/orders}" href="/orders"><i class="fa-solid fa-shopping-bag me-2"></i>Đơn hàng</a></li>
                            <li th:if="${userRole == 'ADMIN'}"><a class="dropdown-item" th:href="@{/admin}" href="/admin"><i class="fa-solid fa-cogs me-2"></i>Quản lý</a></li>
                            <li th:if="${userRole == 'SELLER'}"><a class="dropdown-item" th:href="@{/seller/stall-management}" href="/seller/stall-management"><i class="fa-solid fa-store me-2"></i>Quản lí gian hàng</a></li>
                            <li th:if="${userRole == 'SELLER'}"><a class="dropdown-item" th:href="@{/withdraw}" href="/withdraw"><i class="fa-solid fa-money-bill-transfer me-2"></i>Rút tiền</a></li>
                            <li><a class="dropdown-item" th:href="@{/payment-history}" href="/payment-history"><i class="fa-solid fa-credit-card me-2"></i>Lịch sử thanh toán</a></li>
                            <li><a class="dropdown-item" th:href="@{/change-password}" href="/change-password"><i class="fa-solid fa-key me-2"></i>Đổi mật khẩu</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fa-solid fa-heart me-2"></i>Yêu thích</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="window.authManager.logout(); return false;"><i class="fa-solid fa-right-from-bracket me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>

                    <a class="btn btn-outline-secondary d-flex align-items-center gap-2" href="#" aria-label="Tin nhắn">
                        <i class="fa-solid fa-message"></i>
                        <span>Tin nhắn</span>
                    </a>

                    <a class="btn btn-outline-danger d-flex align-items-center gap-2" th:href="@{/cart}" href="/cart" aria-label="Giỏ hàng">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <span>Giỏ hàng</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<main class="container py-4 py-md-5">
    <!-- Policy Text -->
    <div class="policy-text">
        <div class="policy-marquee">
            <strong>Đối với gian hàng không trùng, chúng tôi cam kết sản phẩm được bán ra 1 lần duy nhất trên hệ thống, tránh trường hợp sản phẩm đó được bán nhiều lần.</strong>
        </div>
    </div>

    <!-- Shop Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <h1 class="mb-0 me-3" th:text="${shop.shopName}">Tên Shop</h1>
                    <span class="online-badge">Online</span>
                    <span class="verified-badge ms-2">Đã xác thực</span>
                </div>
                <a class="btn btn-outline-primary" th:href="@{/products}" href="/products">
                    <i class="fa-solid fa-arrow-left me-2"></i>
                    Quay lại danh sách shop
                </a>
            </div>
            <p class="text-muted" th:text="${shop.description}">Mô tả shop</p>
        </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-filters">
        <form class="row g-3" method="get">
            <div class="col-md-3">
                <label for="search" class="form-label">Tìm kiếm sản phẩm</label>
                <input type="text" class="form-control" id="search" name="q" placeholder="Nhập tên sản phẩm...">
            </div>
            <div class="col-md-2">
                <label for="type" class="form-label">Loại sản phẩm</label>
                <select class="form-select" id="type" name="type">
                    <option value="">Tất cả</option>
                    <option value="email">Email</option>
                    <option value="software">Software</option>
                    <option value="game">Game</option>
                    <option value="social">Social Media</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="sort" class="form-label">Sắp xếp</label>
                <select class="form-select" id="sort" name="sort">
                    <option value="name">Tên A-Z</option>
                    <option value="rating">Đánh giá cao</option>
                    <option value="sales">Bán chạy</option>
                </select>
            </div>
            <div class="col-md-1">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fa-solid fa-search"></i>
                </button>
            </div>
        </form>
    </div>

    <!-- Products Grid -->
    <div class="row g-4">
        <div class="col-12 col-md-6 col-lg-4" th:each="product: ${products}">
            <div class="card h-100 product-card position-relative" th:onclick="'window.location.href=\'/product/' + ${product.id} + '\''">
                <!-- Product Image -->
                <div class="position-relative">
                    <img th:alt="${product.name}" th:src="@{|https://picsum.photos/seed/${product.uniqueKey}/600/400|}" 
                         class="product-image">
                    
                    <!-- Unique Badge -->
                    <div class="unique-badge">KHÔNG TRÙNG</div>
                    
                    <!-- Sponsored Badge (random) -->
                    <div class="sponsored-badge" th:if="${product.id % 3 == 0}">
                        <i class="fa-solid fa-star me-1"></i>Tài trợ
                    </div>
                </div>

                <!-- Product Info -->
                <div class="card-body p-3">
                    <!-- Product Title -->
                    <h6 class="product-title" th:text="${product.name}">Tên sản phẩm</h6>
                    
                    <!-- Rating -->
                    <div class="product-rating">
                        <span class="stars">
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                        </span>
                        <span th:text="${#numbers.formatInteger(product.id * 100 + 500, 0, 'COMMA')}">1000</span> Reviews
                    </div>
                    
                    <!-- Sales Info -->
                    <div class="product-sales">
                        Đã bán: <span th:text="${#numbers.formatInteger(product.id * 1000 + 50000, 0, 'COMMA')}">50000</span> | 
                        Khiếu nại: 0.0%
                    </div>
                    
                    <!-- Seller Info -->
                    <div class="product-seller">
                        Người bán: <span th:text="${shop.shopName}">Shop Name</span> | 
                        <span class="online-badge">Online</span> | 
                        <span class="verified-badge">Đã xác thực</span>
                    </div>
                    
                    <!-- Product Type -->
                    <div class="product-type">
                        Sản phẩm: <span th:text="${product.type}">Loại sản phẩm</span>
                    </div>
                    
                    <!-- Product Description -->
                    <div class="product-description" th:text="${product.description}">
                        Mô tả sản phẩm chi tiết với các tính năng nổi bật
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- No Products Message -->
    <div th:if="${products.isEmpty()}" class="text-center py-5">
        <i class="fa-solid fa-box-open text-muted" style="font-size: 64px;"></i>
        <h4 class="text-muted mt-3">Shop chưa có sản phẩm</h4>
        <p class="text-muted">Shop này chưa có sản phẩm nào để bán.</p>
    </div>

</main>

<footer class="border-top py-3 mt-5">
    <div class="container d-flex justify-content-between align-items-center small">
        <div>© <span th:text="${#temporals.format(#temporals.createNow(),'yyyy')}">2025</span> MMO Market</div>
        <div class="text-muted">Liên hệ: support@example.com</div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>